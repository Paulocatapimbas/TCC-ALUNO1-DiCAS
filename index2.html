<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Firebase v10 Crud</title>
        <style>
            label{
                display: inline-block;
                font-size: 16px;
                font-family: Arial, Helvetica, sans-serif;
                width: 110px;
            }

            input,select{
                width: 180px;
                height: 30px;
                font-size: 16px;
                font-family: Arial, Helvetica, sans-serif;
            }

            button{
                height: 30px;
                width: 70px;
            }
        </style>
    </head>
    <body>
        <label>Descricao do Item</label>
        <input type="text" id="DescripItem">
        <br><br>

        <label>Possivel dono:</label>
        <input type="text" id="OwnerItem">
        <br><br>

        <label>Tipo de Item</label>
        <select id="DeptInp">
            <option value="Caderno">Caderno</option>
            <option value="Bolsa">Bolsa</option>
            <option value="Dinheiro">Dinheiro</option>
            <option value="Carteira">Carteira</option>
        </select>
        <br><br>

        
        <label>Local Armazenado</label>
        <select id="LocalInp">
            <option value="Diretora">Diretora</option>
            <option value="Portaria">Portaria</option>
            <option value="Professor">Professor</option>
            <option value="Armario">Armario</option>
            <option value="Secretaria">Secretaria</option>
        </select>
        <br><br>

        <label>N.ยบ Identificador</label>
        <input type="number" id="CnicInp">
        <br><br>

        <button id="AddBtn">Add</button>
        <button id="RetrieveBtn">Retrieve</button>
        <button id="UpdateBtn">Update</button>
        <button id="RemoveBtn">Delete</button>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";

            const firebaseConfig = {
              apiKey: "AIzaSyDv3gRmq0IIt0Z8nSHiB5EmQnZvF-SsAvs",
              authDomain: "james-49ebb.firebaseapp.com",
              databaseURL: "https://james-49ebb-default-rtdb.firebaseio.com",
              projectId: "james-49ebb",
              storageBucket: "james-49ebb.appspot.com",
              messagingSenderId: "652791022044",
              appId: "1:652791022044:web:8b99fdea61e6d98b978f19",
              measurementId: "G-BHWJ59XY41"
            };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            
            import {getDatabase, ref,child,get,set,update,remove} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js"
          
            const db = getDatabase();

            let DescripItem = document.getElementById('DescripItem');
            let OwnerItem = document.getElementById('OwnerItem');
            let DeptInp = document.getElementById('DeptInp');
            let LocalInp = document.getElementById('LocalInp');

            let AddBtn = document.getElementById('AddBtn');
            let RetrieveBtn = document.getElementById('RetrieveBtn');
            let UpdateBtn = document.getElementById('UpdateBtn');
            let RemoveBtn = document.getElementById('RemoveBtn');

            function AddData(){
                set(ref(db,'ObjectSet/'+CnicInp.value),{
                    nameofobject: DescripItem.value,
                    nameofowner:  OwnerItem.value,
                    department: DeptInp.value,
                    local: LocalInp.value,
                    cnic: Number(CnicInp.value)
                }).then(()=>{
                    alert("Data Added Sucessfully");
                }).Catch(()=>{
                    alert("Error");
                    console.log(error);
                })
            }

            function retData() {
                const dbRef = ref(db);
                const cnicValue = CnicInp.value;
                const DescripItemValue = DescripItem.value;

                if (cnicValue) {
                    // Try to retrieve by CNIC
                    get(child(dbRef, 'ObjectSet/' + cnicValue)).then((snapshot) => {
                        if (snapshot.exists()) {
                            // Data found by CNIC
                            DescripItem.value = snapshot.val().nameofobject;
                            OwnerItem.value = snapshot.val().nameofowner;
                            DeptInp.value = snapshot.val().department;
                            LocalInp.value = snapshot.val().local;
                        } else {
                            alert("No data available for this CNIC");
                        }
                    }).catch((error) => {
                        alert("Error retrieving data");
                        console.log(error);
                    });
                } else if (DescripItemValue) {
                    // If no CNIC, search by description
                    get(child(dbRef, 'ObjectSet')).then((snapshot) => {
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            let found = false;

                            for (const key in data) {
                                if (data[key].nameofobject === DescripItemValue) {
                                    DescripItem.value = data[key].nameofobject;
                                    OwnerItem.value = data[key].nameofowner;
                                    DeptInp.value = data[key].department;
                                    LocalInp.value = data[key].local;
                                    CnicInp.value = data[key].cnic;
                                    found = true;
                                    break;
                                }
                            }

                            if (!found) {
                                alert("No data available for this description");
                            }
                        } else {
                            alert("No data available");
                        }
                    }).catch((error) => {
                        alert("Error retrieving data");
                        console.log(error);
                    });
                } else {
                    alert("Please enter either CNIC or Description to retrieve data.");
                }
            }



            
            function UpdateData(){
                update(ref(db,'ObjectSet/'+CnicInp.value),{
                    nameofobject:DescripItem.value,
                    nameofowner: OwnerItem.value,
                    department: DeptInp.value,
                    local: LocalInp.value
                }).then(()=>{
                    alert("Data Updated Sucessfully");
                }).Catch(()=>{
                    alert("Error");
                    console.log(error);
                })
            }

            function DeleteData(){
                remove(ref(db,'ObjectSet/'+CnicInp.value)).then(()=>{
                    alert("Data Deleted Sucessfully");
                }).Catch(()=>{
                    alert("Error");
                    console.log(error);
                })
            }

            AddBtn.addEventListener('click',AddData);
            RetrieveBtn.addEventListener('click',retData);
            UpdateBtn.addEventListener('click',UpdateData);
            RemoveBtn.addEventListener('click',DeleteData);
          </script>
    </body>
</html>